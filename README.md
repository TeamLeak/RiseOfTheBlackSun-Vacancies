# Vacancy API Server

Этот проект представляет собой серверное приложение, реализующее API для работы с вакансиями и заявками соискателей.

## Особенности

- **Публичные маршруты (/api):**
  - Получение списка вакансий с использованием in‑memory кэширования для быстрого ответа.
  - Получение конкретной вакансии по ID (с попыткой использовать кэш).
  - Прием заявок соискателей с автоматической установкой начального статуса "pending".

- **Административные маршруты (/admin):**
  - Создание, обновление и удаление вакансий.
  - Получение списка вакансий (административная версия).
  - Получение, обновление и удаление заявок соискателей.
  - Отправка email уведомлений заявителям через SMTP.
  - Доступ к административным маршрутам ограничен с помощью CORS (разрешены только домены, указанные в конфигурационном файле).

- **In‑memory кэширование вакансий:**
  - Для оптимизации быстродействия GET-запросов используется кэш, который автоматически инвалидируется после изменений (создание, обновление или удаление вакансии).

## Требования

- Go (версия 1.16 или выше)
- SQLite (используется как база данных по умолчанию)

## Установка и запуск

1. **Клонируйте репозиторий:**

2. **Настройте конфигурацию.**  
   Создайте файл `config.json` в корневой директории проекта со следующим содержимым:

   ```json
   {
     "serverPort": 8080,
     "dbDriver": "sqlite",
     "dbSource": "gorm.db",
     "smtpHost": "smtp.example.com",
     "smtpPort": 587,
     "smtpUsername": "user@example.com",
     "smtpPassword": "password",
     "adminAllowedOrigins": [
       "http://localhost:3000",
       "https://myadminsite.com"
     ]
   }
   ```

   _Пояснения:_
   - **serverPort**: Порт, на котором будет запущен сервер.
   - **dbDriver** и **dbSource**: Параметры подключения к базе данных (в данном примере используется SQLite).
   - **smtpHost**, **smtpPort**, **smtpUsername**, **smtpPassword**: Параметры SMTP для отправки email.
   - **adminAllowedOrigins**: Список доменов, которым разрешен доступ к административным маршрутам.

3. **Установите зависимости:**

   Если вы используете модули Go, выполните команду:

   ```bash
   go mod tidy
   ```

4. **Соберите и запустите приложение:**

   ```bash
   go build -o vacancy-api-server
   ./vacancy-api-server
   ```

   После запуска сервер будет доступен на указанном в `config.json` порту (например, [http://localhost:8080](http://localhost:8080)).

## API Маршруты

### Public API (Префикс: `/api`)

1. **GET `/api/vacancies`**  
   - **Описание:** Возвращает список всех вакансий в формате JSON.
   - **Особенности:** Использует in‑memory кэширование для ускорения ответа.

2. **GET `/api/vacancies/{id}`**  
   - **Описание:** Возвращает вакансию по указанному ID.
   - **Особенности:** Если вакансия присутствует в кэше, данные отдаются оттуда, иначе выполняется запрос к базе данных.

3. **POST `/api/apply`**  
   - **Описание:** Принимает заявку (application) от соискателя в формате JSON.
   - **Параметры:**  
     - `primaryContact` – основной контакт (например, Telegram, VK, Discord).
     - `additionalContacts` – дополнительные контакты (список в формате JSON).
     - `name` – имя соискателя.
     - `about` – информация о себе.
     - `vacancyId` – идентификатор вакансии.
     - `salaryExpectation` – ожидаемая зарплата.
     - `availableFrom` – дата начала работы.
   - **Особенности:** После сохранения заявки ей автоматически присваивается статус `"pending"`.

### Admin API (Префикс: `/admin`)

_Обратите внимание, что доступ к данным маршрутам ограничен через CORS. Разрешенные домены указываются в `config.json`._

1. **POST `/admin/vacancy`**  
   - **Описание:** Создает новую вакансию.
   - **Параметры:** JSON объект с данными вакансии (заголовок, подзаголовок, описание, URL изображения, цветовой градиент, требования, технологии и т.д.).
   - **Особенности:** После создания вакансии происходит инвалидирование кэша.

2. **PUT `/admin/vacancy/{id}`**  
   - **Описание:** Обновляет данные существующей вакансии по указанному ID.
   - **Параметры:** JSON объект с обновленными данными вакансии.
   - **Особенности:** ID вакансии не изменяется, кэш инвалидируется после обновления.

3. **DELETE `/admin/vacancy/{id}`**  
   - **Описание:** Удаляет вакансию по указанному ID.
   - **Особенности:** Кэш инвалидируется после удаления.

4. **GET `/admin/vacancies`**  
   - **Описание:** Возвращает список всех вакансий (административная версия).
   - **Особенности:** Используется та же логика, что и в публичном GET `/api/vacancies`.

5. **GET `/admin/applications`**  
   - **Описание:** Возвращает список всех заявок соискателей.
   - **Формат:** JSON объект с массивом заявок.

6. **GET `/admin/application/{id}`**  
   - **Описание:** Возвращает данные заявки по указанному ID.

7. **PUT `/admin/application/{id}`**  
   - **Описание:** Обновляет заявку (например, изменение статуса).
   - **Параметры:** JSON объект с обновленными данными заявки.

8. **DELETE `/admin/application/{id}`**  
   - **Описание:** Удаляет заявку по указанному ID.

9. **POST `/admin/application/{id}/send-email`**  
   - **Описание:** Отправляет email уведомление заявителю.
   - **Параметры:** JSON объект с полями `subject` (тема письма) и `body` (текст письма).
   - **Особенности:** Письмо отправляется на адрес, указанный в поле `PrimaryContact` заявки.

## Лицензия

Этот проект распространяется под [MIT License](LICENSE).
